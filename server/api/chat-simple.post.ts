// server/api/chat-simple.post.ts
export default defineEventHandler(async (event) => {
  try {
    const { message } = await readBody(event)
    
    if (!message) {
      return { error: 'Нужно сообщение' }
    }

    // Простые ответы для Казахстана с ценами в тенге
    const responses: Record<string, string> = {
      'кран': `Ремонт протекающего крана на кухне

Подготовка к работе:
• Выключите воду - найдите вентили под раковиной
• Слейте остаток воды, открыв кран
• Подготовьте инструменты (стоимость в магазинах Казахстана 1000-3000 ₸):
  - Разводной ключ
  - Новые прокладки или картридж
  - Фум-лента
  - Тряпки для уборки

Пошаговый ремонт:
1. Снимите декоративный колпачок на ручке
2. Открутите фиксирующий винт
3. Снимите ручку и открутите гайку картриджа
4. Извлеките старый картридж и замените на новый
5. Соберите все в обратном порядке
6. Включите воду и проверьте

Советы для Казахстана:
• Запчасти можно купить в Технодом, Меломан, Sulpak
• Стоимость картриджа: 1500-4000 ₸
• Если не уверены - вызовите сантехника (5000-15000 ₸)`,

      'розетка': `Решение проблем с розеткой

Безопасность прежде всего! Если нет опыта - вызовите электрика.

Что проверить:
1. Автоматы в электрощитке - возможно сработала защита
2. Другие розетки в комнате - если тоже не работают, проблема в проводке
3. Саму розетку - нет ли почернений, запаха гари

Если решили заменить сами:
• Купите новую розетку (500-2000 ₸ в строительных магазинах)
• Отключите электричество в щитке
• Аккуратно замените старую розетку на новую
• Включите электричество и проверьте

Магазины в Казахстане:
• Электротовары в Технодом, Меломан
• Строительные магазины: Леруа Мерлен, Строймаркет

Стоимость вызова электрика: 3000-8000 ₸`,

      'духовка': `Чистка духовки от жира

Средства для чистки (стоимость 500-2000 ₸):
• Специальные гели для духовок
• Народные средства: сода, уксус

Пошаговая инструкция:
1. Нанесите средство на внутренние поверхности
2. Оставьте на 30-60 минут
3. Протрите жесткой губкой или щеткой
4. Тщательно промойте водой
5. Вытрите насухо

Экологичные варианты:
• Сода + уксус - эффективно и безопасно
• Лимонный сок - убирает запахи

Где купить средства:
• Супермаркеты: Магнум, Small
• Хозтовары: в любом магазине бытовой химии`,

      'организация': `Организация хранения в маленькой прихожей

Практичные решения для казахстанских квартир:

Вертикальное хранение:
• Настенные полки (2000-5000 ₸)
• Крючки для одежды (500-1500 ₸)
• Вешалки-стойки (3000-8000 ₸)

Умные решения:
• Органайзеры для обуви (1000-3000 ₸)
• Пуфик с местом для хранения (5000-15000 ₸)
• Зеркало с полочкой (4000-10000 ₸)

Магазины в Казахстане:
• Мебель: Икеа, Мебель Холл
• Хозтовары: Джум, Супермаркеты

Советы:
• Используйте пространство над дверью
• Установите крючки на внутреннюю сторону двери
• Приобретите компактную банкетку`
    }

    const lowerMessage = message.toLowerCase()
    let response = 'Я помогу с вашей бытовой проблемой! Опишите подробнее, что именно случилось, и я дам практичные советы с учетом условий в Казахстане.'

    for (const [key, answer] of Object.entries(responses)) {
      if (lowerMessage.includes(key)) {
        response = answer
        break
      }
    }

    // Имитация задержки AI
    await new Promise(resolve => setTimeout(resolve, 1000))

    return {
      message: response,
      model: 'local/kz-assistant'
    }

  } catch (error: any) {
    return {
      error: 'Временная проблема с сервером'
    }
  }
})